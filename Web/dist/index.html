<?php

function init($var, $defaultVal){
  if (!isset($_GET[$var])) {
    $_GET[$var] = $defaultVal;
  }
}

// Set default values
init("query", "");
init("time", "999999999");
init("score", "-999999");
init("title", "false");
init("queryexpansion", "false");
init ("andor","false");
init ("qe","false");
init ("len","25");

$time = $_GET["time"];
$query = htmlspecialchars($_GET["query"]); 
$score =$_GET["score"];
$title =$_GET["title"];
$andor = $_GET["andor"];
$qe = $_GET["queryexpansion"];
$len = $_GET["len"];
if(!empty($query))
{
chdir("C:\Users\NMING7\Desktop\cuhk-information-retrieval");
$cmd = "java -jar C:\Users\NMING7\Desktop\cuhk-information-retrieval\search.jar "."$query ". " $len ". " $title". " $score". " $time"." $andor "." $qe "." 2>&1";
exec($cmd, $output);

}
else
 $output = "";
?>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reddit forum search engine</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/freebase/suggest/4_2/suggest.min.css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/freebase/suggest/4_2/suggest.min.js"></script>

  </head>

  <body>
    <div class="jumbotron">
      <div class="container">
        <h1>Reddit forum search engine</h1>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <form role="form" method="GET" action="">
          <div class="col-lg-4">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Query" id="query" name="query" value=
			  <?php
			  echo "\"$query\"";
			  ?>
			  
			  >  <!-- Pass to $query -->
              <span class="input-group-btn">
                <button type="submit" class="btn btn-success">Go!</button>
              </span>
            </div><!-- /input-group -->
          </div><!-- /.col-lg-4 -->
          <div class="col-lg-2">
            <div class="input-group">
              <label>Time range</label>   <!-- Pass to $time -->
              <select class="form-control" id="time" name="time">   
                <option <?php if (strcmp($time,"999999999")==0) echo ' selected '; ?>value="999999999" >All</option>
                <option <?php if (strcmp($time,"47304000")==0) echo ' selected '; ?>value="47304000">Within half year</option>
                <option <?php if (strcmp($time,"63072000")==0) echo ' selected '; ?>value="63072000">Within 1 year</option>
				<option <?php if (strcmp($time,"94608000")==0) echo ' selected '; ?>value="94608000">Within 2 year</option>
              </select>
            </div><!-- /input-group -->
          </div><!-- /.col-lg-2 -->
          <div class="col-lg-2">
            <div class="input-group">
              <label>Score range</label> <!-- Pass to $score -->
              <select class="form-control" id="score" name="score">
                <option <?php if (strcmp($score,"-999999")==0) echo ' selected '; ?>value="-999999">No limit</option>
                <option <?php if (strcmp($score,"0")==0) echo ' selected '; ?>value="0">Positive score</option>
                <option <?php if (strcmp($score,"50")==0) echo ' selected '; ?>value="50">Above 50</option>
                <option <?php if (strcmp($score,"100")==0) echo ' selected '; ?>value="100">Above 100</option>
              </select>
            </div><!-- /input-group -->
          </div><!-- /.col-lg-2 -->
          <div class="col-lg-2">
            <div class="input-group"> <!-- Pass to $title -->
              <label>Abstruct control</label>
              <select class="form-control" id="title" name="title">
                <option <?php if (strcmp($title,"false")==0) echo ' selected '; ?>value="false">Title only</option>
                <option <?php if (strcmp($title,"true")==0) echo ' selected '; ?>value="true">Title and content</option>
              </select>
            </div><!-- /input-group -->
          </div><!-- /.col-lg-2 -->
		  <br><br><br>
		  <div class="col-lg-2">
            <div class="radio">
              <label><input type="radio" value="false" name="andor" id="andor" <?php if (strcmp($andor,"false")==0) echo ' checked '; ?>> Use OR</label><br>
			  <label><input type="radio" value="true" name="andor" id="andor" <?php if (strcmp($andor,"true")==0) echo ' checked '; ?>> Use AND</label>
            </div><!-- /.col-lg-2 -->
		  </div>
          <div class="col-lg-2">
            <div class="radio">
              <label><input type="radio" value="false" <?php if (strcmp($qe,"false")==0) echo ' checked '; ?>name="queryexpansion" id="queryexpansion">No Query expansion</label>
			  <label><input type="radio" value="true" <?php if (strcmp($qe,"true")==0) echo ' checked '; ?>name="queryexpansion" id="queryexpansion"> Query expansion</label>
            </div>
          </div><!-- /.col-lg-2 -->
		  <div class="col-lg-2">
            <div class="radio">
              <label><input type="radio" value="25" <?php if (strcmp($len,"25")==0) echo ' checked '; ?>name="len" id="len">Show top 25</label>
			  <label><input type="radio" value="1000" <?php if (strcmp($len,"1000")==0) echo ' checked '; ?>name="len" id="len"> Show top 1000</label>
            </div>
          </div><!-- /.col-lg-2 -->
        </form>
      </div><!-- row -->
      <div class="row"><div class="col-lg-12"><br></div></div>
	  
		<?php
		if (strcmp(gettype($output),"array")==0)
		{
		echo "Query search time :$output[1]　　　　　  ";
		$asize = count($output)-1;
		echo "Total result found : $output[$asize]";
		$j=0;
		$i=2;
		
		
		while ($i < count($output)-1)
		{
			if (strcmp($output[$i],",")==0)
			{
				;
			}
			else
			{
				switch($j)	{
				case 0:
				$out_title = $output[$i];
				break;
				case 1:
				$out_time = $output[$i];
				break;
				case 2:
				$out_link= $output[$i];
				break;
				case 3:
				$out_content = htmlentities($output[$i], ENT_QUOTES, 'UTF-8');
				break;
				
				}
				if (strcmp($output[$i+1],",")==0)
				{
					$j++;
				}
			}
			
			if ($j==4)
			{
				$j=0;
				echo "<div class=\"row\">";
				echo "<div class=\"col-lg-12\"><dl> <dt><a href=\"".$out_link."\">".$out_title."</a></dt>";
				echo "<dd style=\"color:forestgreen\">".$out_time."</dd>";
				echo "<dd><span style=\"color:gray\">".$out_link." </span><br>".$out_content."</dd> </dl></div></div>";
			}
		
		
			$i++;
		}
		
		//print_r($output);
		}		
		?>
		

      
    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

    <!-- Include all compiled plugins (below), or include individual files as needed -->

    <script type="text/javascript">
    $(function() {
      $("#query").suggest({
       key: "AIzaSyBlD2AW28ZlT0FbVF7_N215J5tIau6RHn8"
       });
    });
    </script>
  </body>
</html>

